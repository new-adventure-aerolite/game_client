package client

import (
	"encoding/base64"
	"time"

	"github.com/ansoni/termination"
	"github.com/nsf/termbox-go"
)

var (
	rawShape = []string{
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAgKCctJykgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg4KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICBIYWRvdWtlbiAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAvICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJyk+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICBIYWRvdWtlbiAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAvICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJyk+IE8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICBIYWRvdWtlbiAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAvICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJyk+IG9PICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICBIYWRvdWtlbiAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAvICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJyk+IG9vTyAgICAgICAgICAgICAgICAgICAgICAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICBIYWRvdWtlbiAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAvICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJyk+IG9vb08gICAgICAgICAgICAgICAgICAgICAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJyk+ICAgb29vTyAgICAgICAgICAgICAgICAgICAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJyk+ICAgICBvb29PICAgICAgICAgICAgICAgICAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJyk+ICAgICAgIG9vb08gICAgICAgICAgICAgICAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJyk+ICAgICAgICAgb29vTyAgICAgICAgICAgICAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJyk+ICAgICAgICAgICBvb29PICAgICAgICAgICAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICBIYUhhICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAvICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJykgICAgICAgICAgICAgICAgb29vTyAgICAgICAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICBIYUhhICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAvICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJykgICAgICAgICAgICAgICAgICBvb29PICAgICAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICBIYUhhICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAvICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJykgICAgICAgICAgICAgICAgICAgIG9vb08gICAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICBIYUhhICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAvICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJykgICAgICAgICAgICAgICAgICAgICAgb29vTyAgICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICBIYUhhICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAvICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJykgICAgICAgICAgICAgICAgICAgICAgICBvb29PICAgICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJykgICAgICAgICAgICAgICAgICAgICAgICAgIG9vb08gICAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJykgICAgICAgICAgICAgICAgICAgICAgICAgICAgb29vTyAvXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJykgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvb28vXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
		"ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyg5KDkpX18gICAgICAgIF9fL15cL15cX18NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL28gbyAgIFwvXyAgICAgX19cX1xfL1xfL18vXw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcX19fLCAgIFwvXyAgIF9cLicgICAgICAgJy4vXyAgICAgIF8vXF8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAtLS1gXCAgXC9fIF9cLyAgICAgICAgICAgXC9fICAgX3wuJ18vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBcL19cLyAgICAgIC8gICAgICBcL18gIHwvIC8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICBgLScgICAgICB8ICAgICAgICAnO186JyAvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL3wgICAgICAgICAgXCAgICAgIFwgICAgIC4nDQogICAgICAgICAgICAgICAgICAoPictJykgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8vXy8gICB8LF9fXy4tYCcsICAgIC9gJy0tLWANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL19fXy9gICAgICAgIC9fX19fLw==",
	}

	kirbyShape = termination.Shape{
		"default": []string{}}
)

func init() {
	for _, r := range rawShape {
		d, _ := base64.StdEncoding.DecodeString(r)
		kirbyShape["default"] = append(kirbyShape["default"], string(d))
	}
}

type KirbyData struct {
	GotoX int
	GotoY int
}

func kirbyMovement(t *termination.Termination, e *termination.Entity, position termination.Position) termination.Position {
	data, _ := e.Data.(KirbyData)
	if data.GotoX < position.X {
		position.X -= 1
	} else if data.GotoX > position.X {
		position.X += 1
	}

	if data.GotoY < position.Y {
		position.Y -= 1
	} else if data.GotoY > position.Y {
		position.Y += 1
	}
	return position
}

func Hadouken() {
	term := termination.New()
	term.FramesPerSecond = 8
	kirby := term.NewEntity(termination.Position{X: 20, Y: 20, Z: 0})
	kirby.Shape = kirbyShape
	kirby.MovementCallback = kirbyMovement
	kirby.Data = KirbyData{GotoX: 20, GotoY: 20}
	go term.Animate()

	termbox.SetInputMode(termbox.InputEsc | termbox.InputMouse)

	// create a channel to get exit signal from keyboard
	exitC := make(chan bool)
	go func(quit chan bool) {
		switch ev := termbox.PollEvent(); ev.Type {
		case termbox.EventKey:
			if ev.Key == termbox.KeyEsc || ev.Key == termbox.KeyCtrlC {
				term.Close()
				exitC <- true
			}
		}
	}(exitC)

	select {
	case <-exitC:
		term.Close()
	case <-time.After(time.Duration(5 * time.Second)):
		term.Close()
	}
}
